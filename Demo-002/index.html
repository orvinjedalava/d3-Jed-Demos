<!DOCTYPE html>
<html>
  <head>
    <title>Zooming Interaction</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      .selected {
        stroke: #ff0000;
        stroke-width: 2px;
      }
    </style>
  </head>
  <body>
     <script>       
        // Define dimensions and parameters
        const width = 900, height = 600, radius = 10;
        let isZoomed = false; // Track zoom state
        let activeCircle = null; // Track which circle is active
        
        // Function to generate random positions for circles
        function decidePositions(num) {
            const arr = [];
            for (let i = 0; i < num; i++) {
                arr.push({
                    x: Math.random() * (width - 2 * radius) + radius,
                    y: Math.random() * (height - 2 * radius) + radius                     
                });
            }
            return arr;
        }
        
        // Create SVG and container group
        const svg = d3.select("body").append("svg")
                     .attr("width", width)
                     .attr("height", height)
                     .style("background", "pink");
        
        // Create a background rect to catch "click outside" events
        const background = svg.append("rect")
                     .attr("width", width)
                     .attr("height", height)
                     .attr("fill", "none")
                     .attr("pointer-events", "all");
        
        // Create container group for all circles
        const gContainer = svg.append("g");
        
        // Generate positions and set up color scale
        const positions = decidePositions(50);
        const colors = d3.scaleOrdinal(d3.schemeDark2);
        
        // Create circles
        const circles = gContainer.selectAll("circle")
                     .data(positions)
                     .enter()
                     .append("circle")
                     .attr("r", radius)
                     .attr("cx", d => d.x)
                     .attr("cy", d => d.y)
                     .attr("fill", (d, i) => colors(i));
        
        // Define zoom behavior
        const zoom = d3.zoom()
                     .scaleExtent([1, 40])
                     .on("zoom", (event) => {
                         gContainer.attr("transform", event.transform);
                     })
                     .filter(event => {
                         // Disable mousewheel and touch zoom events
                         // Only allow programmatic zooming
                         return !event.type.includes("wheel") && 
                                !event.type.includes("touch") && 
                                !event.type.includes("mouse") &&
                                !event.type.includes("dblclick");
                     });
        
        // Apply zoom behavior to SVG
        svg.call(zoom)
           .on("dblclick.zoom", null);        // Store the initial transform for resetting
        const initialTransform = d3.zoomIdentity;
        
        // Handle circle click - zoom in
        circles.on("click", function(event, d) {
            event.stopPropagation(); // Prevent triggering background click
            
            // Remove previous selection styling
            if (activeCircle) {
                d3.select(activeCircle).classed("selected", false);
            }
            
            // Add selection styling to clicked circle
            d3.select(this).classed("selected", true);
            activeCircle = this;
            
            // Calculate the transform needed to center and zoom on this circle
            const scale = Math.min(8, 0.9 / (radius / Math.min(width, height)));
            const translateX = width / 2 - scale * d.x;
            const translateY = height / 2 - scale * d.y;
            const transform = d3.zoomIdentity.translate(translateX, translateY).scale(scale);
            
            // Animate the zoom using interpolateZoom
            svg.transition()
               .duration(750)
               .call(zoom.transform, transform);
            
            isZoomed = true;
        });
        
        // Handle background click - zoom out
        background.on("click", function() {
            if (isZoomed) {
                // Remove selection styling
                if (activeCircle) {
                    d3.select(activeCircle).classed("selected", false);
                    activeCircle = null;
                }
                
                // Animate back to the initial view
                svg.transition()
                   .duration(750)
                   .call(zoom.transform, initialTransform);
                
                isZoomed = false;
            }
        });
     </script>
  </body>
</html>
